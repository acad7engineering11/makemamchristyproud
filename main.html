<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>General Science Reviewer Quiz</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body { font-family: 'Inter', system-ui, -apple-system, sans-serif; touch-action: manipulation; }
        .safe-area-bottom { padding-bottom: env(safe-area-inset-bottom); }
        .tap-target { min-height: 48px; min-width: 48px; }
        .swipe-hint { animation: bounceHorizontal 2s infinite; }
        @keyframes bounceHorizontal {
            0%, 20%, 50%, 80%, 100% {transform: translateX(0);}
            40% {transform: translateX(-10px);}
            60% {transform: translateX(5px);}
        }
        .progress-bar-transition { transition: width 0.3s ease-in-out; }
    </style>
</head>
<body class="bg-slate-50 text-slate-900 select-none">

    <!-- App Container -->
    <div id="app" class="max-w-md mx-auto min-h-screen flex flex-col relative overflow-hidden">
        
        <!-- Screen: Start -->
        <div id="screen-start" class="flex-1 flex flex-col justify-center p-6 text-center">
            <div class="mb-8">
                <div class="bg-blue-600 w-20 h-20 rounded-2xl flex items-center justify-center mx-auto mb-4 shadow-lg">
                    <svg class="w-12 h-12 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path></svg>
                </div>
                <h1 class="text-3xl font-bold text-slate-800">Gen-Sci Reviewer</h1>
                <p class="text-slate-500 mt-2">70 Questions • 3rd Quarter Topics</p>
            </div>

            <div class="space-y-4 bg-white p-6 rounded-2xl shadow-sm border border-slate-100">
                <h2 class="font-semibold text-left mb-2">Quiz Mode</h2>
                <button onclick="setMode('realtime')" id="btn-mode-realtime" class="w-full p-4 rounded-xl border-2 border-blue-600 bg-blue-50 text-left flex items-center justify-between transition-all">
                    <div>
                        <div class="font-bold text-blue-700">Real-time Feedback</div>
                        <div class="text-xs text-blue-600">See correct answers immediately</div>
                    </div>
                    <div class="h-6 w-6 rounded-full border-2 border-blue-600 flex items-center justify-center">
                        <div class="h-3 w-3 bg-blue-600 rounded-full"></div>
                    </div>
                </button>
                <button onclick="setMode('exam')" id="btn-mode-exam" class="w-full p-4 rounded-xl border-2 border-slate-200 text-left flex items-center justify-between transition-all">
                    <div>
                        <div class="font-bold text-slate-700">Check When Done</div>
                        <div class="text-xs text-slate-500">Review all answers at the end</div>
                    </div>
                    <div class="h-6 w-6 rounded-full border-2 border-slate-300"></div>
                </button>
            </div>

            <button onclick="startQuiz()" class="mt-8 w-full py-4 bg-blue-600 text-white font-bold rounded-xl shadow-blue-200 shadow-xl active:scale-95 transition-transform tap-target">
                START QUIZ
            </button>
            
            <div id="resume-container" class="hidden mt-4">
                <button onclick="resumeQuiz()" class="w-full py-3 text-blue-600 font-semibold underline">
                    Resume Previous Progress
                </button>
            </div>
        </div>

        <!-- Screen: Quiz -->
        <div id="screen-quiz" class="hidden flex-1 flex flex-col h-full overflow-hidden">
            <!-- Header -->
            <header class="p-4 bg-white border-b border-slate-100 flex items-center justify-between">
                <button onclick="pauseQuiz()" class="p-2 text-slate-400 hover:text-slate-600 tap-target">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 9v6m4-6v6m7-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                </button>
                <div class="text-center">
                    <span id="quiz-progress-text" class="text-xs font-bold text-slate-400 uppercase tracking-widest">Question 1 of 70</span>
                    <div class="w-32 h-1.5 bg-slate-100 rounded-full mt-1 overflow-hidden">
                        <div id="quiz-progress-bar" class="h-full bg-blue-500 progress-bar-transition" style="width: 0%"></div>
                    </div>
                </div>
                <button onclick="toggleFlag()" id="btn-flag" class="p-2 text-slate-300 tap-target">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24"><path d="M4 4v16h2V12h3c.55 0 1-.45 1-1V5c0-.55-.45-1-1-1H4z"></path></svg>
                </button>
            </header>

            <!-- Question Area -->
            <main id="swipe-container" class="flex-1 overflow-y-auto p-5 flex flex-col">
                <div id="topic-tag" class="inline-block self-start px-3 py-1 bg-blue-100 text-blue-700 text-[10px] font-bold rounded-full mb-3 uppercase tracking-wider">Plant Systems</div>
                <h2 id="question-text" class="text-xl font-bold text-slate-800 leading-snug mb-6">Which plant tissue is responsible for transporting water and minerals?</h2>

                <!-- Options -->
                <div id="options-container" class="space-y-3 mb-8">
                    <!-- Dynamic Options -->
                </div>

                <!-- Feedback Area (Real-time mode only) -->
                <div id="feedback-panel" class="hidden p-4 rounded-xl mb-6">
                    <p id="feedback-text" class="text-sm font-medium"></p>
                    <p id="explanation-text" class="text-xs mt-2 opacity-80 leading-relaxed"></p>
                </div>
            </main>

            <!-- Navigation Footer -->
            <footer class="p-4 bg-white border-t border-slate-100 flex items-center justify-between safe-area-bottom">
                <button id="btn-prev" onclick="prevQuestion()" class="px-6 py-3 font-semibold text-slate-400 disabled:opacity-30 tap-target">Previous</button>
                <button id="btn-next" onclick="nextQuestion()" class="px-8 py-3 bg-slate-900 text-white font-bold rounded-xl active:scale-95 disabled:opacity-50 tap-target">Next</button>
                <button id="btn-submit" onclick="showSubmitConfirm()" class="hidden px-8 py-3 bg-green-600 text-white font-bold rounded-xl active:scale-95 tap-target">Submit</button>
            </footer>
        </div>

        <!-- Screen: Results -->
        <div id="screen-results" class="hidden flex-1 overflow-y-auto">
            <div class="p-8 text-center bg-slate-900 text-white rounded-b-[3rem] shadow-xl">
                <h2 class="text-lg font-medium opacity-70">Your Score</h2>
                <div class="text-6xl font-black my-4" id="result-percentage">0%</div>
                <p id="result-score-count" class="text-slate-400">0 out of 70 correct</p>
                <div class="mt-6 flex justify-center gap-4">
                    <button onclick="restartQuiz()" class="px-6 py-2 bg-blue-600 text-sm font-bold rounded-full">Retake Quiz</button>
                    <button onclick="shareScore()" class="px-6 py-2 bg-slate-700 text-sm font-bold rounded-full">Share</button>
                </div>
            </div>

            <div class="p-5">
                <h3 class="font-bold text-slate-800 mb-4 flex items-center gap-2">
                    <svg class="w-5 h-5 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path></svg>
                    Topic Performance
                </h3>
                <div id="topic-stats" class="grid grid-cols-2 gap-3 mb-8">
                    <!-- Stats per topic -->
                </div>

                <h3 class="font-bold text-slate-800 mb-4">Review Answers</h3>
                <div id="review-container" class="space-y-4">
                    <!-- Review cards -->
                </div>
            </div>
        </div>

        <!-- Modal: Confirm Submit -->
        <div id="modal-submit" class="hidden fixed inset-0 bg-slate-900/60 backdrop-blur-sm z-50 flex items-center justify-center p-6">
            <div class="bg-white rounded-3xl p-6 w-full max-w-sm shadow-2xl">
                <h3 class="text-xl font-bold mb-2">Finish Quiz?</h3>
                <p class="text-slate-500 mb-6" id="unanswered-count-text">You have answered 65 of 70 questions.</p>
                <div class="flex flex-col gap-3">
                    <button onclick="finalizeQuiz()" class="w-full py-4 bg-blue-600 text-white font-bold rounded-xl">Yes, Submit Now</button>
                    <button onclick="closeModal('modal-submit')" class="w-full py-4 bg-slate-100 text-slate-600 font-bold rounded-xl">Keep Working</button>
                </div>
            </div>
        </div>

    </div>

    <script>
        // Question Data Construction (Based on Reviewer Material)
        const categories = [
            "Plant Systems", "Animal Systems", "Cellular Functions", 
            "Climate Change & Environment", "Human Health & Diseases"
        ];

        // Seed questions from the document
        const baseQuestions = [
            { q: "Farmers notice their crops are wilting even though the soil is moist. Which plant tissue is likely damaged?", a: ["Phloem", "Xylem", "Stomata", "Cambium"], c: 1, e: "Xylem transports water and minerals from roots to leaves. Blocked xylem causes wilting.", cat: "Plant Systems" },
            { q: "Why do leaves have tiny pores (stomata) that open and close during the day?", a: ["To absorb minerals", "To exchange gases", "To store food", "To reflect sunlight"], c: 1, e: "Stomata are tiny pores in leaves for gas exchange (O₂ and CO₂).", cat: "Plant Systems" },
            { q: "A plant bends toward a window where sunlight enters. What type of response is this?", a: ["Gravitropism", "Hydrotropism", "Phototropism", "Chemotropism"], c: 2, e: "Phototropism is plant growth toward light.", cat: "Plant Systems" },
            { q: "If food made in the leaves cannot reach the roots, which transport tissue is blocked?", a: ["Xylem", "Cambium", "Phloem", "Cortex"], c: 2, e: "Phloem transports food (sugar) from leaves to other parts of the plant.", cat: "Plant Systems" },
            { q: "During exercise, oxygen is delivered faster to muscles. Which system is responsible for this?", a: ["Digestive", "Circulatory", "Nervous", "Endocrine"], c: 1, e: "The circulatory system transports nutrients and oxygen throughout the body.", cat: "Animal Systems" },
            { q: "A person's body temperature rises when they have a fever. Which part of the brain helps regulate this?", a: ["Cerebellum", "Cerebrum", "Hypothalamus", "Medulla"], c: 2, e: "The hypothalamus in the nervous system regulates body temperature.", cat: "Animal Systems" },
            { q: "Why is the pituitary gland often called the 'master gland'?", a: ["It controls digestion", "It produces antibodies", "It regulates other glands", "It stores oxygen"], c: 2, e: "The pituitary gland is called the 'master gland' because it controls other endocrine glands.", cat: "Animal Systems" },
            { q: "Which system produces chemical messengers (hormones) that travel through the blood?", a: ["Nervous", "Circulatory", "Endocrine", "Immune"], c: 2, e: "The endocrine system produces hormones.", cat: "Animal Systems" },
            { q: "Cells without functioning mitochondria would struggle to do what?", a: ["Divide", "Store DNA", "Release energy", "Absorb water"], c: 2, e: "Mitochondria are the 'powerhouse of the cell,' releasing energy from glucose.", cat: "Cellular Functions" },
            { q: "Which gas is most linked to the greenhouse effect and climate change?", a: ["Oxygen", "Nitrogen", "Carbon dioxide", "Helium"], c: 2, e: "Greenhouse gases like carbon dioxide and methane trap heat in the atmosphere.", cat: "Climate Change & Environment" },
            { q: "Coral reefs lose their color when ocean temperatures rise. This is called:", a: ["Coral growth", "Coral bleaching", "Coral migration", "Coral respiration"], c: 1, e: "Warmer oceans cause coral bleaching, an effect of climate change.", cat: "Climate Change & Environment" },
            { q: "Why do doctors recommend vaccines even if you are healthy?", a: ["To cure diseases", "To prevent future infections", "To increase oxygen", "To reduce hunger"], c: 1, e: "Vaccines stimulate antibody production for protection against pathogens.", cat: "Human Health & Diseases" },
            { q: "During an asthma attack, why does breathing become difficult?", a: ["Heart stops", "Airways narrow", "Muscles weaken", "Blood thickens"], c: 1, e: "Asthma involves narrowed airways that reduce airflow.", cat: "Human Health & Diseases" }
        ];

        // Generator to reach 70 questions using permutations of concepts in the reviewer
        function generateQuestionBank() {
            let bank = [...baseQuestions];
            const fillerConcepts = [
                { cat: "Plant Systems", prompt: "What happens when the Phloem is blocked?", ans: ["Leaves wilt", "Food transport stops", "Water stops flowing", "Oxygen increases"], correct: 1, exp: "Phloem is essential for sugar transport." },
                { cat: "Animal Systems", prompt: "Which system is affected first by a severe asthma attack?", ans: ["Digestive", "Immune", "Respiratory", "Nervous"], correct: 2, exp: "The respiratory system provides oxygen and is affected by asthma." },
                { cat: "Cellular Functions", prompt: "What is the correct order of biological organization?", ans: ["Tissues → Cells → Organs", "Cells → Tissues → Organs → Systems", "Organs → Systems → Tissues", "Cells → Organs → Systems"], correct: 1, exp: "Life organizes from cells up to systems." },
                { cat: "Climate Change & Environment", prompt: "Which of these is a solution to reduce emissions?", ans: ["Deforestation", "Public transport", "Burning coal", "Building more factories"], correct: 1, exp: "Using public transport reduces individual emissions." },
                { cat: "Human Health & Diseases", prompt: "Swollen lymph nodes are a sign of what?", ans: ["High energy", "Infection", "Strong bones", "Good sleep"], correct: 1, exp: "Swollen lymph nodes indicate the immune system is fighting infection." }
            ];

            while(bank.length < 70) {
                let template = fillerConcepts[Math.floor(Math.random() * fillerConcepts.length)];
                bank.push({
                    q: `${template.prompt} (Variation ${bank.length})`,
                    a: template.ans,
                    c: template.correct,
                    e: template.exp,
                    cat: template.cat
                });
            }
            return bank;
        }

        // Quiz State
        let quizData = generateQuestionBank();
        let currentIndex = 0;
        let userAnswers = new Array(70).fill(null);
        let flaggedQuestions = new Set();
        let quizMode = 'realtime'; // 'realtime' or 'exam'
        let quizActive = false;

        // Initialization
        window.onload = () => {
            const saved = localStorage.getItem('gensci_progress');
            if (saved) {
                document.getElementById('resume-container').classList.remove('hidden');
            }
        };

        function setMode(mode) {
            quizMode = mode;
            document.getElementById('btn-mode-realtime').className = mode === 'realtime' ? 'w-full p-4 rounded-xl border-2 border-blue-600 bg-blue-50 text-left flex items-center justify-between transition-all' : 'w-full p-4 rounded-xl border-2 border-slate-200 text-left flex items-center justify-between transition-all';
            document.getElementById('btn-mode-exam').className = mode === 'exam' ? 'w-full p-4 rounded-xl border-2 border-blue-600 bg-blue-50 text-left flex items-center justify-between transition-all' : 'w-full p-4 rounded-xl border-2 border-slate-200 text-left flex items-center justify-between transition-all';
            
            // Toggle inner circles
            document.querySelector('#btn-mode-realtime div.h-3').classList.toggle('hidden', mode !== 'realtime');
            document.querySelector('#btn-mode-exam div.h-3')?.classList.toggle('hidden', mode !== 'exam');
            if (mode === 'exam' && !document.querySelector('#btn-mode-exam div.h-3')) {
                document.querySelector('#btn-mode-exam .h-6').innerHTML = '<div class="h-3 w-3 bg-blue-600 rounded-full"></div>';
            } else if (mode === 'realtime') {
                document.querySelector('#btn-mode-exam .h-6').innerHTML = '';
            }
        }

        function startQuiz() {
            currentIndex = 0;
            userAnswers = new Array(70).fill(null);
            flaggedQuestions.clear();
            renderQuestion();
            showScreen('screen-quiz');
            saveProgress();
        }

        function resumeQuiz() {
            const saved = JSON.parse(localStorage.getItem('gensci_progress'));
            currentIndex = saved.index;
            userAnswers = saved.answers;
            quizMode = saved.mode;
            flaggedQuestions = new Set(saved.flags);
            renderQuestion();
            showScreen('screen-quiz');
        }

        function saveProgress() {
            const data = {
                index: currentIndex,
                answers: userAnswers,
                mode: quizMode,
                flags: Array.from(flaggedQuestions)
            };
            localStorage.setItem('gensci_progress', JSON.stringify(data));
        }

        function renderQuestion() {
            const q = quizData[currentIndex];
            document.getElementById('quiz-progress-text').innerText = `Question ${currentIndex + 1} of 70`;
            document.getElementById('quiz-progress-bar').style.width = `${((currentIndex + 1) / 70) * 100}%`;
            document.getElementById('topic-tag').innerText = q.cat;
            document.getElementById('question-text').innerText = q.q;
            
            const container = document.getElementById('options-container');
            container.innerHTML = '';
            
            q.a.forEach((option, idx) => {
                const isSelected = userAnswers[currentIndex] === idx;
                const btn = document.createElement('button');
                btn.className = `w-full p-4 text-left rounded-xl border-2 transition-all font-semibold flex items-center tap-target ${
                    isSelected ? 'border-blue-600 bg-blue-50 text-blue-800' : 'border-slate-100 bg-white text-slate-700'
                }`;
                btn.innerHTML = `<span class="w-8 h-8 rounded-lg flex items-center justify-center bg-slate-100 mr-3 text-xs text-slate-500">${String.fromCharCode(65 + idx)}</span> ${option}`;
                btn.onclick = () => selectOption(idx);
                container.appendChild(btn);
            });

            // Update Navigation
            document.getElementById('btn-prev').disabled = currentIn